# ExamVerse Deployment Guide (Render)

This guide covers deploying ExamVerse to Render using the included `render.yaml` Blueprint.

## üöÄ Quick Deploy

### Prerequisites
- GitHub repository with your code
- [Render account](https://render.com) (free tier available)
- MongoDB Atlas account (free tier M0 cluster recommended)

### One-Click Deploy

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Deploy to Render"
   git push origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click **"New"** ‚Üí **"Blueprint"**
   - Connect your GitHub repository
   - Render will automatically detect `render.yaml`

3. **Configure Environment Variables**
   
   Set these in Render Dashboard for `examverse-api`:
   
   ```bash
   # Required
   MONGODB_URL=mongodb+srv://username:password@cluster.mongodb.net/
   DATABASE_NAME=examverse
   SECRET_KEY=<auto-generated by Render>
   
   # Optional API Keys (for full features)
   GEMINI_API_KEY=your-google-gemini-api-key
   YOUTUBE_API_KEY=your-youtube-data-api-key
   OCR_SPACE_API_KEY=your-ocr-space-api-key
   
   # CORS (update after frontend deployment)
   ALLOWED_ORIGINS=https://your-frontend.onrender.com
   ```

4. **Deploy**
   - Click **"Apply"**
   - Render will deploy both services automatically
   - Backend: `https://examverse-api.onrender.com`
   - Frontend: `https://examverse-frontend.onrender.com`

## üìã Service Configuration

### Backend API (`examverse-api`)
- **Type:** Web Service
- **Runtime:** Python 3.11
- **Plan:** Starter ($7/month) or Free
- **Build:** `pip install -r requirements.txt`
- **Start:** `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
- **Health Check:** `/health`

### Frontend (`examverse-frontend`)
- **Type:** Static Site
- **Runtime:** Node 20
- **Plan:** Free
- **Build:** `npm install && npm run build`
- **Publish:** `./dist`
- **Auto-routing:** SPA mode (all routes ‚Üí index.html)

## üîß Environment Variables

### Backend Required

| Variable | Description | Example |
|----------|-------------|---------|
| `MONGODB_URL` | MongoDB connection string | `mongodb+srv://...` |
| `DATABASE_NAME` | Database name | `examverse` |
| `SECRET_KEY` | JWT secret (auto-generated) | `<random-string>` |

### Backend Optional

| Variable | Description | Default |
|----------|-------------|---------|
| `ALLOWED_ORIGINS` | CORS origins (comma-separated) | `*` |
| `UPLOAD_DIR` | Upload directory | `uploads` |
| `MAX_FILE_SIZE` | Max file size in bytes | `10485760` (10MB) |
| `GEMINI_API_KEY` | Google Gemini AI key | _(disabled)_ |
| `YOUTUBE_API_KEY` | YouTube Data API key | _(disabled)_ |
| `OCR_SPACE_API_KEY` | OCR.space API key | _(disabled)_ |

### Frontend

| Variable | Description | Auto-configured |
|----------|-------------|-----------------|
| `VITE_API_URL` | Backend API URL | ‚úì (from backend service) |

## üóÑÔ∏è MongoDB Setup (Atlas)

1. **Create Free Cluster**
   - Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/register)
   - Create M0 (free) cluster
   - Choose closest region to Oregon (for Render)

2. **Configure Access**
   - Database Access ‚Üí Add user (username + password)
   - Network Access ‚Üí Add IP: `0.0.0.0/0` (allow all)

3. **Get Connection String**
   - Cluster ‚Üí Connect ‚Üí Connect your application
   - Copy connection string
   - Replace `<password>` with your database user password
   - Use in `MONGODB_URL` env var

## üîê API Keys Setup

### Google Gemini AI (Optional)
```bash
# Get key at: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=AIza...
```

### YouTube Data API (Optional)
```bash
# Enable at: https://console.cloud.google.com/apis/library/youtube.googleapis.com
YOUTUBE_API_KEY=AIza...
```

### OCR.space API (Optional)
```bash
# Get free key at: https://ocr.space/ocrapi
OCR_SPACE_API_KEY=K8...
```

## üîÑ Update CORS After Deployment

Once frontend is deployed, update backend CORS:

```bash
# In Render Dashboard ‚Üí examverse-api ‚Üí Environment
ALLOWED_ORIGINS=https://examverse-frontend.onrender.com,https://your-custom-domain.com
```

Then restart the backend service.

## üö® Troubleshooting

### Backend Not Starting
- Check logs: `Render Dashboard ‚Üí examverse-api ‚Üí Logs`
- Verify `MONGODB_URL` is correct
- Ensure MongoDB Atlas allows connections from `0.0.0.0/0`

### Frontend 404 on Routes
- Check `routes` config in `render.yaml` (SPA rewrite)
- Verify build output is in `dist/` folder
- Check build logs for errors

### CORS Errors
- Update `ALLOWED_ORIGINS` to include frontend URL
- Restart backend after changing env vars
- Clear browser cache

### File Uploads Failing
- Render free tier has limited disk (no persistent storage)
- Consider upgrading to paid plan or use cloud storage (S3, Cloudinary)
- Current setup uses ephemeral disk (files lost on restart)

### Health Check Failing
- Test endpoint: `https://examverse-api.onrender.com/health`
- Should return: `{"status": "healthy", "api": "operational", "database": "connected"}`
- If database shows error, check MongoDB connection

## üìä Monitoring

### Health Checks
- Render automatically monitors `/health` endpoint
- Service restarts automatically if unhealthy
- Configure alerts in Render Dashboard

### Logs
- Backend: `Render Dashboard ‚Üí examverse-api ‚Üí Logs`
- Frontend: Build logs only (static site)
- Enable persistent logging in paid plans

## üí∞ Cost Estimate

### Free Tier
- Backend: Free (with cold starts after 15 min inactivity)
- Frontend: Free (static site)
- MongoDB: Free (M0 cluster, 512MB)
- **Total: $0/month**

### Starter Tier (Recommended for Production)
- Backend: $7/month (no cold starts)
- Frontend: Free
- MongoDB: Free or $9/month (M2 cluster, 2GB)
- **Total: $7-16/month**

## üîÑ CI/CD

Auto-deploy is enabled by default:
- Push to `main` branch ‚Üí Auto deploy both services
- Pull requests ‚Üí Preview deploys (frontend only)

Disable auto-deploy:
```yaml
# In render.yaml, add to service:
autoDeploy: false
```

## üåê Custom Domain

1. Add domain in Render Dashboard
2. Update DNS records (provided by Render)
3. Add domain to `ALLOWED_ORIGINS`
4. SSL certificates auto-provisioned

## üìö Additional Resources

- [Render Docs](https://render.com/docs)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)
- [Vite Production Build](https://vitejs.dev/guide/build.html)
- [MongoDB Atlas](https://www.mongodb.com/docs/atlas/)

## üÜò Support

- Render Support: https://render.com/docs/support
- MongoDB Support: https://support.mongodb.com/
- Project Issues: [GitHub Issues](https://github.com/Exam-Verse/backend/issues)
